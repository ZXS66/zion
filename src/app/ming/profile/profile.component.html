<h2>{{pageTitle}}</h2>
<form (ngSubmit)="updateMember()">
	<fieldset>
		<legend>åŸºç¡€ä¿¡æ¯</legend>
		@if (member.avatar_url && member.avatar_url.length > 0) {
		<img [src]="member.avatar_url" alt="å¤´åƒ" width="300" [title]="member.avatar_url" />
		}
		@else {
		<mat-form-field>
			<mat-label>å¤´åƒ</mat-label>
			<input matInput [(ngModel)]="member.avatar_url" name="avatar_url" type="url" placeholder="å¤´åƒé“¾æ¥"
				[readonly]="!manipulationMode" />
		</mat-form-field>
		}
		<mat-form-field>
			<mat-label>å§“å</mat-label>
			<input matInput [(ngModel)]="member.name" name="name" placeholder="æœ±å…ƒç’‹" required readonly />
		</mat-form-field>
		<mat-form-field>
			<mat-label>æ‹¼éŸ³</mat-label>
			<input matInput [(ngModel)]="member.pin_yin" name="pin_yin" placeholder="zhÅ« yuÃ¡n zhÄng" readonly />
		</mat-form-field>
		<mat-form-field>
			<mat-label>æ€§åˆ«</mat-label>
			<mat-select name="gender" [(ngModel)]="member.gender" [disabled]="!manipulationMode">
				<mat-option [value]="0">æœªçŸ¥â“</mat-option>
				<mat-option [value]="1">ç”·â™‚ï¸</mat-option>
				<mat-option [value]="2">å¥³â™€ï¸</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field>
			<mat-label>çˆ¶</mat-label>
			<mat-select name="father_id" [(ngModel)]="member.father_id" [disabled]="!manipulationMode">
				<mat-option>æœªçŸ¥</mat-option>
				@for (nm of males;track nm.value) {
				<mat-option [value]="nm.value">{{nm.name}} (ğŸ†”{{nm.value}})</mat-option>
				}
			</mat-select>
			<!-- <input matInput [formControl]="fatherCtrl" [matAutocomplete]="autoFathers" />
			<mat-autocomplete #autoFathers="matAutocomplete" (optionSelected)="selectFather($event.option.value)">
				@for (option of filteredFathers | async; track option.value) {
				<mat-option [value]="option.value">{{option.name}} (ğŸ†”{{option.value}})</mat-option>
				}
			</mat-autocomplete> -->
		</mat-form-field>
		<mat-form-field>
			<mat-label>æ¯</mat-label>
			<mat-select name="mother_id" [(ngModel)]="member.mother_id" [disabled]="!manipulationMode">
				<mat-option>æœªçŸ¥</mat-option>
				@for (nm of females;track nm.value) {
				<mat-option [value]="nm.value">{{nm.name}} (ğŸ†”{{nm.value}})</mat-option>
				}
			</mat-select>
			<!-- <input matInput [formControl]="motherCtrl" [matAutocomplete]="autoMothers" />
			<mat-autocomplete #autoMothers="matAutocomplete" (optionSelected)="selectMother($event.option.value)">
				@for (option of filteredMothers | async; track option.value) {
				<mat-option [value]="option.value">{{option.name}} (ğŸ†”{{option.value}})</mat-option>
				}
			</mat-autocomplete> -->
		</mat-form-field>
		<mat-form-field>
			<mat-label>è¯è¾°</mat-label>
			<input matInput [(ngModel)]="member.birthday" name="birthday" type="date" [readonly]="!manipulationMode">
		</mat-form-field>
		<mat-form-field>
			<mat-label>ç¥­æ—¥</mat-label>
			<input matInput [(ngModel)]="member.deathday" name="deathday" type="date" [readonly]="!manipulationMode" />
		</mat-form-field>
		<mat-form-field>
			<mat-label>ç®€ä»‹</mat-label>
			<textarea matInput [(ngModel)]="member.summary" name="summary" [readonly]="!manipulationMode"></textarea>
		</mat-form-field>
	</fieldset>
	<fieldset class="extra">
		<legend>æ‰©å±•ä¿¡æ¯</legend>
		<div class="flex" *ngIf="extraInfo&&extraInfo.length">
			<ng-container *ngFor="let kv of extraInfo; let i = index">
				@if (manipulationMode) {
				<div class="col-2">
					<button mat-icon-button color="warn" (click)="removeExtra(i)" title="åˆ é™¤æ­¤æ‰©å±•ä¿¡æ¯">
						<mat-icon>delete</mat-icon>
					</button>
				</div>
				}
				<div [ngClass]="manipulationMode?'col-5':'col-6'">
					<mat-form-field>
						<mat-label>é”®</mat-label>
						<input matInput [(ngModel)]="kv[0]" name="{{kv[0]}}" [ngModelOptions]="{standalone: true}"
							[matAutocomplete]="autoCommonExtraKeys" [readonly]="!manipulationMode" />
					</mat-form-field>
				</div>
				<div [ngClass]="manipulationMode?'col-5':'col-6'">
					<mat-form-field>
						<mat-label>å€¼</mat-label>
						<input matInput [(ngModel)]="kv[1]" name="{{kv[1]}}" [ngModelOptions]="{standalone: true}"
							[readonly]="!manipulationMode" />
					</mat-form-field>
				</div>
			</ng-container>
		</div>
		@if (manipulationMode) {
		<button mat-flat-button color="primary" (click)="addExtra()">
			<mat-icon>add</mat-icon>
			æ·»åŠ æ‰©å±•ä¿¡æ¯
		</button>
		}
	</fieldset>
	<div class="actions">
		<mat-progress-bar *ngIf="loadingStatus===1" mode="indeterminate"></mat-progress-bar>
		<div *ngIf="loadingStatus===2" style="color:green">æ›´æ–°æˆåŠŸï¼</div>
		<div *ngIf="loadingStatus===3" style="color:red">{{message.ERROR}}</div>
	</div>
	<div class="actions" style="padding: 1em 0;">
		<a mat-stroked-button routerLink="/ming/list" queryParamsHandling="merge" type="reset">
			<mat-icon>arrow_back</mat-icon>
			è¿”å›æ¸…å•
		</a>
		@if (manipulationMode) {
		<button mat-flat-button color="primary" type="submit" [disabled]="loadingStatus!==0">
			<mat-icon *ngIf="loadingStatus===0">update</mat-icon>
			<mat-icon *ngIf="loadingStatus===1">loading</mat-icon>
			<mat-icon *ngIf="loadingStatus===2">check</mat-icon>
			<mat-icon *ngIf="loadingStatus===3">error</mat-icon>
			æ›´æ–°
		</button>
		}
	</div>
</form>
<mat-autocomplete #autoCommonExtraKeys="matAutocomplete">
	@for (option of commonExtraKeys; track option) {
	<mat-option [value]="option">{{option}}</mat-option>
	}
</mat-autocomplete>